package com.stytch.java.b2b.api.rbacorganizations

// !!!
// WARNING: This file is autogenerated
// Only modify code within MANUAL() sections
// or your changes may be overwritten later!
// !!!

import com.squareup.moshi.JsonAdapter
import com.squareup.moshi.Moshi
import com.squareup.moshi.Types
import com.stytch.java.b2b.models.rbacorganizations.GetOrgPolicyRequest
import com.stytch.java.b2b.models.rbacorganizations.GetOrgPolicyResponse
import com.stytch.java.b2b.models.rbacorganizations.SetOrgPolicyRequest
import com.stytch.java.b2b.models.rbacorganizations.SetOrgPolicyResponse
import com.stytch.java.common.InstantAdapter
import com.stytch.java.common.StytchResult
import com.stytch.java.http.HttpClient
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.async
import kotlinx.coroutines.future.asCompletableFuture
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext
import java.util.concurrent.CompletableFuture

public interface Organizations {
    /**
     * Get the active RBAC Policy for a specific Organization within your Stytch Project. An Organization RBAC Policy contains
     * the roles that have been defined specifically for that organization, allowing for organization-specific permissioning
     * models.
     *
     * This endpoint returns the organization-scoped roles that supplement the project-level RBAC policy. Organization
     * policies allow you to define custom roles that are specific to individual organizations within your project.
     *
     * When using the backend SDKs, the RBAC Policy will be cached to allow for local evaluations, eliminating the need for an
     * extra request to Stytch. The policy will be refreshed if an authorization check is requested and the RBAC policy was
     * last updated more than 5 minutes ago.
     *
     * Organization-specific roles can be created and managed through this API endpoint, providing fine-grained control over
     * permissions at the organization level.
     *
     * Check out the [RBAC overview](https://stytch.com/docs/b2b/guides/rbac/overview) to learn more about Stytch's RBAC
     * permissioning model and organization-scoped policies.
     */
    public suspend fun getOrgPolicy(data: GetOrgPolicyRequest): StytchResult<GetOrgPolicyResponse>

    /**
     * Get the active RBAC Policy for a specific Organization within your Stytch Project. An Organization RBAC Policy contains
     * the roles that have been defined specifically for that organization, allowing for organization-specific permissioning
     * models.
     *
     * This endpoint returns the organization-scoped roles that supplement the project-level RBAC policy. Organization
     * policies allow you to define custom roles that are specific to individual organizations within your project.
     *
     * When using the backend SDKs, the RBAC Policy will be cached to allow for local evaluations, eliminating the need for an
     * extra request to Stytch. The policy will be refreshed if an authorization check is requested and the RBAC policy was
     * last updated more than 5 minutes ago.
     *
     * Organization-specific roles can be created and managed through this API endpoint, providing fine-grained control over
     * permissions at the organization level.
     *
     * Check out the [RBAC overview](https://stytch.com/docs/b2b/guides/rbac/overview) to learn more about Stytch's RBAC
     * permissioning model and organization-scoped policies.
     */
    public fun getOrgPolicy(
        data: GetOrgPolicyRequest,
        callback: (StytchResult<GetOrgPolicyResponse>) -> Unit,
    )

    /**
     * Get the active RBAC Policy for a specific Organization within your Stytch Project. An Organization RBAC Policy contains
     * the roles that have been defined specifically for that organization, allowing for organization-specific permissioning
     * models.
     *
     * This endpoint returns the organization-scoped roles that supplement the project-level RBAC policy. Organization
     * policies allow you to define custom roles that are specific to individual organizations within your project.
     *
     * When using the backend SDKs, the RBAC Policy will be cached to allow for local evaluations, eliminating the need for an
     * extra request to Stytch. The policy will be refreshed if an authorization check is requested and the RBAC policy was
     * last updated more than 5 minutes ago.
     *
     * Organization-specific roles can be created and managed through this API endpoint, providing fine-grained control over
     * permissions at the organization level.
     *
     * Check out the [RBAC overview](https://stytch.com/docs/b2b/guides/rbac/overview) to learn more about Stytch's RBAC
     * permissioning model and organization-scoped policies.
     */
    public fun getOrgPolicyCompletable(data: GetOrgPolicyRequest): CompletableFuture<StytchResult<GetOrgPolicyResponse>>

    /**
     * Set the RBAC Policy for a specific Organization within your Stytch Project. An Organization RBAC Policy allows you to
     * define roles that are specific to that organization, providing fine-grained control over permissions at the
     * organization level.
     *
     * This endpoint allows you to create, update, or replace the organization-scoped roles for a given organization.
     * Organization policies supplement the project-level RBAC policy with additional roles that are only applicable within
     * the context of that specific organization.
     *
     * The organization policy consists of roles, where each role defines:
     * - A unique `role_id` to identify the role
     * - A human-readable `description` of the role's purpose
     * - A set of `permissions` that specify which actions can be performed on which resources
     *
     * When you set an organization policy, it will replace any existing organization-specific roles for that organization.
     * The project-level RBAC policy remains unchanged.
     *
     * Organization-specific roles are useful for scenarios where different organizations within your project require
     * different permission structures, such as:
     * - Multi-tenant applications with varying access levels per tenant
     * - Organizations with custom approval workflows
     * - Different organizational hierarchies requiring unique role definitions
     *
     * Check out the [RBAC overview](https://stytch.com/docs/b2b/guides/rbac/overview) to learn more about Stytch's RBAC
     * permissioning model and organization-scoped policies.
     */
    public suspend fun setOrgPolicy(data: SetOrgPolicyRequest): StytchResult<SetOrgPolicyResponse>

    /**
     * Set the RBAC Policy for a specific Organization within your Stytch Project. An Organization RBAC Policy allows you to
     * define roles that are specific to that organization, providing fine-grained control over permissions at the
     * organization level.
     *
     * This endpoint allows you to create, update, or replace the organization-scoped roles for a given organization.
     * Organization policies supplement the project-level RBAC policy with additional roles that are only applicable within
     * the context of that specific organization.
     *
     * The organization policy consists of roles, where each role defines:
     * - A unique `role_id` to identify the role
     * - A human-readable `description` of the role's purpose
     * - A set of `permissions` that specify which actions can be performed on which resources
     *
     * When you set an organization policy, it will replace any existing organization-specific roles for that organization.
     * The project-level RBAC policy remains unchanged.
     *
     * Organization-specific roles are useful for scenarios where different organizations within your project require
     * different permission structures, such as:
     * - Multi-tenant applications with varying access levels per tenant
     * - Organizations with custom approval workflows
     * - Different organizational hierarchies requiring unique role definitions
     *
     * Check out the [RBAC overview](https://stytch.com/docs/b2b/guides/rbac/overview) to learn more about Stytch's RBAC
     * permissioning model and organization-scoped policies.
     */
    public fun setOrgPolicy(
        data: SetOrgPolicyRequest,
        callback: (StytchResult<SetOrgPolicyResponse>) -> Unit,
    )

    /**
     * Set the RBAC Policy for a specific Organization within your Stytch Project. An Organization RBAC Policy allows you to
     * define roles that are specific to that organization, providing fine-grained control over permissions at the
     * organization level.
     *
     * This endpoint allows you to create, update, or replace the organization-scoped roles for a given organization.
     * Organization policies supplement the project-level RBAC policy with additional roles that are only applicable within
     * the context of that specific organization.
     *
     * The organization policy consists of roles, where each role defines:
     * - A unique `role_id` to identify the role
     * - A human-readable `description` of the role's purpose
     * - A set of `permissions` that specify which actions can be performed on which resources
     *
     * When you set an organization policy, it will replace any existing organization-specific roles for that organization.
     * The project-level RBAC policy remains unchanged.
     *
     * Organization-specific roles are useful for scenarios where different organizations within your project require
     * different permission structures, such as:
     * - Multi-tenant applications with varying access levels per tenant
     * - Organizations with custom approval workflows
     * - Different organizational hierarchies requiring unique role definitions
     *
     * Check out the [RBAC overview](https://stytch.com/docs/b2b/guides/rbac/overview) to learn more about Stytch's RBAC
     * permissioning model and organization-scoped policies.
     */
    public fun setOrgPolicyCompletable(data: SetOrgPolicyRequest): CompletableFuture<StytchResult<SetOrgPolicyResponse>>
}

internal class OrganizationsImpl(
    private val httpClient: HttpClient,
    private val coroutineScope: CoroutineScope,
) : Organizations {
    private val moshi = Moshi.Builder().add(InstantAdapter()).build()

    override suspend fun getOrgPolicy(data: GetOrgPolicyRequest): StytchResult<GetOrgPolicyResponse> =
        withContext(Dispatchers.IO) {
            var headers = emptyMap<String, String>()

            val asJson = moshi.adapter(GetOrgPolicyRequest::class.java).toJson(data)
            val type = Types.newParameterizedType(Map::class.java, String::class.java, Any::class.java)
            val adapter: JsonAdapter<Map<String, Any>> = moshi.adapter(type)
            val asMap = adapter.fromJson(asJson) ?: emptyMap()
            httpClient.get("/v1/b2b/rbac/organizations/${data.organizationId}", asMap, headers)
        }

    override fun getOrgPolicy(
        data: GetOrgPolicyRequest,
        callback: (StytchResult<GetOrgPolicyResponse>) -> Unit,
    ) {
        coroutineScope.launch {
            callback(getOrgPolicy(data))
        }
    }

    override fun getOrgPolicyCompletable(data: GetOrgPolicyRequest): CompletableFuture<StytchResult<GetOrgPolicyResponse>> =
        coroutineScope.async {
            getOrgPolicy(data)
        }.asCompletableFuture()

    override suspend fun setOrgPolicy(data: SetOrgPolicyRequest): StytchResult<SetOrgPolicyResponse> =
        withContext(Dispatchers.IO) {
            var headers = emptyMap<String, String>()

            val asJson = moshi.adapter(SetOrgPolicyRequest::class.java).toJson(data)
            httpClient.put("/v1/b2b/rbac/organizations/${data.organizationId}", asJson, headers)
        }

    override fun setOrgPolicy(
        data: SetOrgPolicyRequest,
        callback: (StytchResult<SetOrgPolicyResponse>) -> Unit,
    ) {
        coroutineScope.launch {
            callback(setOrgPolicy(data))
        }
    }

    override fun setOrgPolicyCompletable(data: SetOrgPolicyRequest): CompletableFuture<StytchResult<SetOrgPolicyResponse>> =
        coroutineScope.async {
            setOrgPolicy(data)
        }.asCompletableFuture()
}
